<!-- public/admin.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Admin Control Panel</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f9; color: #333; padding: 20px; }
    h1, h2 { color: #0d47a1; }
    input { padding: 8px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 8px 15px; background-color: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #0d47a1; }
    pre { background: #eee; padding: 15px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body>
  <h1>Painel de Controle do Admin</h1>

  <h2>Definir Papel do Usuário</h2>
  <p>Digite o email do usuário e o papel que você quer dar a ele (ex: 'admin').</p>
  <input type="email" id="email" placeholder="Email do usuário">
  <input type="text" id="role" placeholder="Papel (ex: admin)">
  <button onclick="setRole()">Definir Papel</button>

  <hr>
  <h2>Resultados</h2>
  <pre id="results">Aguardando comando...</pre>

  <!-- SDKs do Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-functions-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

  <script>
    // Configuração do Firebase para o seu app.
    const firebaseConfig = {
      apiKey: "AIzaSyBuHqY5vQzEaJ2_OJ3n8BikUYzrKOc25ao",
      authDomain: "studio-4432826442-a8369.firebaseapp.com",
      projectId: "studio-4432826442-a8369",
      storageBucket: "studio-4432826442-a8369.firebasestorage.app",
      messagingSenderId: "1024534251714",
      appId: "1:1024534251714:web:455040c9aa30d7b912d35b"
    };

    // Inicializa o Firebase
    firebase.initializeApp(firebaseConfig);
    const functions = firebase.functions();
    const auth = firebase.auth();
    const resultsDiv = document.getElementById('results');

    // Função para chamar nossa Cloud Function
    async function setRole() {
      const email = document.getElementById('email').value;
      const role = document.getElementById('role').value;
      
      if (!email || !role) {
        resultsDiv.innerText = 'Por favor, preencha o email e o papel.';
        return;
      }

      resultsDiv.innerText = `Chamando a função para tornar ${email} um ${role}...`;

      // Para chamar uma função, precisamos de um usuário autenticado,
      // mesmo que a regra de segurança esteja desativada por enquanto.
      // Vamos usar um login anônimo simples para este painel de teste.
      try {
        await auth.signInAnonymously();
        
        const setUserRoleCallable = functions.httpsCallable('setUserRole');
        const result = await setUserRoleCallable({ email: email, role: role });
        
        resultsDiv.innerText = JSON.stringify(result.data, null, 2);
      } catch (error) {
        console.error("Erro ao chamar a função: ", error);
        resultsDiv.innerText = `Erro: ${error.message}`;
      }
    }
  </script>
</body>
</html>